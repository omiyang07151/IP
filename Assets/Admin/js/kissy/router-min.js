/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 13 18:02
*/
KISSY.add("router/utils",["event/dom"],function(e,d){function a(b){return b.replace(/__ks-vid=.+$/,"")}function k(b){var a;return(a=b.match(/__ks-vid=(.+)$/))?parseInt(a[1],10):0}var h=d("event/dom");return{endWithSlash:function(b){return e.endsWith(b,"/")},startWithSlash:function(b){return e.startsWith(b,"/")},removeEndSlash:function(b){this.endWithSlash(b)&&(b=b.substring(0,b.length-1));return b},removeStartSlash:function(b){this.startWithSlash(b)&&(b=b.substring(1));return b},addEndSlash:function(b){return this.removeEndSlash(b)+
"/"},addStartSlash:function(b){return b?"/"+this.removeStartSlash(b):b},getFullPath:function(b,a){return location.protocol+"//"+location.host+this.removeEndSlash(a)+this.addStartSlash(b)},equalsIgnoreSlash:function(b,a){b=this.removeEndSlash(b);a=this.removeEndSlash(a);return b===a},getHash:function(b){return a(b.getFragment().replace(/^!/,"")).replace(h.REPLACE_HISTORY,"")},removeVid:a,hasVid:function(b){return-1!==b.indexOf("__ks-vid=")},addVid:function(b,a){return b+"__ks-vid="+a},getVidFromUrlWithHash:function(b){return k((new e.Uri(b)).getFragment())},
getVidFromHash:k}});
KISSY.add("router/route",[],function(e){function d(a,h,b,d){e.isArray(a)&&(a="("+a.join("|")+")");a=a.concat(b?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(b,a,k,e,d,f,g){h.push(e);a=a||"";return""+(f?"":a)+"(?:"+(f?a:"")+(k||"")+(d||k&&"([^/.]+?)"||"([^/]+?)")+")"+(f||"")+(g?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)");return{keys:h,regexp:RegExp("^"+a+"$",d?"":"i")}}function a(a,h,b){this.path=a;this.callbacks=h;this.keys=[];"string"===
typeof a||e.isArray(a)?e.mix(this,d(a,this.keys,b.strict,b.caseSensitive)):this.regexp=a}a.prototype={match:function(a){a=a.match(this.regexp);if(!a)return!1;for(var d=this.keys,b=[],l=1,p=a.length;l<p;++l){var n=d[l-1],s="string"===typeof a[l]?e.urlDecode(a[l]):a[l];n?b[n]=s:b.push(s)}return b},removeCallback:function(a){for(var e=this.callbacks||[],b=e.length-1;0<=b;b++)e===a&&e.splice(b,1)}};return a});
KISSY.add("router/request",[],function(e){function d(a){e.mix(this,a)}d.prototype={param:function(a){return a in this.params?this.params[a]:this.query[a]}};return d});
KISSY.add("router","./router/utils,./router/route,uri,./router/request,event/dom,event/custom".split(","),function(e,d,a){function k(a,b){var c=g.addVid("#!"+a+(B?"":b?t.REPLACE_HISTORY:""),o);b?location.replace(c):location.hash=c}function h(a){a=a||location.href;a=new C(a);if(!i.useHash&&m){var b=a.query;return a.getPath().substr(i.urlRoot.length)+(b.has()?"?"+b.toString():"")}return g.getHash(a)}function b(a,b,c){function v(){d++;if(d===f)c(a,b);else{var g=q[d];if(e.startsWith(a.path+"/",g[0]+"/")){var h=
g[0].length;a.url=a.url.slice(h);var i=a.path;a.path=a.path.slice(h);g[1](a,v);a.url=a.originalUrl;a.path=i}else v()}}var d=-1,f=q.length;v()}function l(a,b){function c(){e++;if(e!==d){var g=f[e];if(a.params=g.match(a.path)){var h=-1,i=g.callbacks,m=i.length,k=function(e){if(e==="route"){k=null;c()}else{h++;if(h!==m){a.route=g;i[h](a,b,k)}}};k("")}else c()}}var e=-1,d=f.length;c()}function p(y,z){var c=h(),d=new e.Uri(c),g=d.query.get();d.query.reset();c=new D({query:g,backward:y===true,replace:z===
true,forward:y===false&&z===false,path:d.toString()||"/",url:c,originalUrl:c});d={redirect:a.navigate};a.fire("dispatch",{request:c,response:d});b(c,d,l)}function n(a){var b=false,c=false;if(a===j[j.length-2]){b=true;j.pop()}else a!==j[j.length-1]?j.push(a):c=true;p(b,c)}function s(a){(a=a.originalEvent.state)&&n(a.vid)}function x(a){(a=A(a.newURL||location.href))&&n(a)}var q=[],f=[],g=d("./router/utils"),E=d("./router/route"),C=d("uri"),D=d("./router/request"),t=d("event/dom"),d=d("event/custom"),
A=g.getVidFromUrlWithHash,u=e.Env.host,r=u.history,B=e.Feature.isHashChangeSupported(),m=!(!r||!r.pushState),o=10,j=[o],i={urlRoot:"",useHash:!m};e.mix(a,d.Target);a.use=function(a,b){if(typeof a!=="string"){b=a;a=""}q.push([a,b])};a.navigate=function(a,b){var b=b||{},c=b.replace||false;if(h()!==a){if(!c){o++;j.push(o)}if(!i.useHash&&m){r[c?"replaceState":"pushState"]({vid:o},"",g.getFullPath(a,i.urlRoot));p(false,c)}else if(m){r[c?"replaceState":"pushState"]({vid:o},"","#!"+a);p(false,c)}else k(a,
c)}else b&&b.triggerRoute&&p(false,true)};a.get=function(a){var b=e.makeArray(arguments).slice(1);f.push(new E(a,b,i))};a.matchRoute=function(a){for(var b=0,c=f.length;b<c;b++)if(f[b].match(a))return f[b];return false};a.removeRoute=function(a,b){for(var c=f.length-1;c>=0;c--){var d=f[c];if(d.path===a)if(b){d.removeCallback(b);d.callbacks.length||f.splice(c,1)}else f.splice(c,1)}};a.clearRoutes=function(){q=[];f=[]};a.hasRoute=function(a){for(var b=0,c=f.length;b<c;b++)if(f[b].path===a)return f[b];
return false};a.config=function(a){if(a.urlRoot)a.urlRoot=a.urlRoot.replace(/\/$/,"");e.mix(i,a)};var w;a.start=function(b){if(w)return b&&b.call(a);var d=i.useHash,c=i.urlRoot,f=i.triggerRoute,l=location.pathname,j=location.href,n=h(),q=location.hash.match(/#!.+/);if(!d)if(m){if(q&&g.equalsIgnoreSlash(l,c)){r.replaceState({},"",g.getFullPath(n,c));f=1}}else if(g.equalsIgnoreSlash(l,c))d=true;else{location.replace(g.addEndSlash(c)+"#!"+n);return}setTimeout(function(){var c=m;if(m)t.on(u,"popstate",
s);else{t.on(u,"hashchange",x);f=1}if(d)if(h())if(!m&&A(j)!==o){k(g.getHash(new e.Uri(j)),true);f=0}else m&&g.hasVid(j)&&location.replace(j=g.removeVid(j));else{a.navigate("/",{replace:1});f=0;c=false}c&&r.replaceState({vid:o},"",j);f&&p(false,true);b&&b(a)},100);w=true;return a};a.Utils=g;a.stop=function(){w=false;t.detach(u,"hashchange",x);t.detach(u,"popstate",s)}});
