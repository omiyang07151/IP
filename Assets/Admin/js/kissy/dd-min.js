/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 14 15:43
*/
KISSY.add("dd/ddm",["node","base"],function(c,e){function k(h){var a=h.get("activeDrag").get("activeHandler"),i="auto";a&&(i=a.css("cursor"));"auto"===i&&(i=h.get("dragCursor"));h._shim.css({cursor:i,display:"block"});o&&s.call(h)}function j(h){var a=h.get("drops");h.setInternal("validDrops",[]);a.length&&c.each(a,function(i){i._active()})}function l(h){var a=h.get("drops");h.setInternal("validDrops",[]);a.length&&c.each(a,function(i){i._deActive()})}function g(h){var a=h.offset();return{left:a.left,
right:a.left+(h.__ddCachedWidth||h.outerWidth()),top:a.top,bottom:a.top+(h.__ddCachedHeight||h.outerHeight())}}function a(a,b){return a.left<=b.left&&a.right>=b.left&&a.top<=b.top&&a.bottom>=b.top}function b(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function d(a,b){var i=Math.max(a.top,b.top),d=Math.min(a.right,b.right),m=Math.min(a.bottom,b.bottom);return{left:Math.max(a.left,b.left),right:d,top:i,bottom:m}}function p(a){a&&(a.__ddCachedWidth=a.outerWidth(),a.__ddCachedHeight=
a.outerHeight())}var f=e("node"),n=e("base"),t=c.UA,u=f.all,f=c.Env.host,r=f.document,w=u(r),q=u(f),o=6===t.ie,n=n.extend({addDrop:function(a){this.get("drops").push(a)},removeDrop:function(a){var b=this.get("drops"),a=c.indexOf(a,b);-1!==a&&b.splice(a,1)},start:function(a,b){this.setInternal("activeDrag",b);b.get("shim")&&v(this);this.__needDropCheck=0;b.get("groups")&&(j(this),this.get("validDrops").length&&(p(b.get("node")),this.__needDropCheck=1))},addValidDrop:function(a){this.get("validDrops").push(a)},
_notifyDropsMove:function(h,e){var i=this.get("validDrops"),x=e.get("mode"),m=0,f=0,p=g(e.get("node")),j=b(p);c.each(i,function(i){if(!i.get("disabled")){var c;if(c=i.getNodeFromTarget(h,e.get("dragNode")[0],e.get("node")[0]))if("point"===x)a(g(c),e.mousePos)&&(c=b(g(c)),m?c<f&&(m=i,f=c):(m=i,f=c));else if("intersect"===x)c=b(d(p,g(c))),c>f&&(f=c,m=i);else if("strict"===x&&(c=b(d(p,g(c))),c===j))return m=i,!1}});if((i=this.get("activeDrop"))&&i!==m)i._handleOut(h),e._handleOut(h);this.setInternal("activeDrop",
m);m&&(i!==m?m._handleEnter(h):m._handleOver(h))},move:function(a,b){this.__needDropCheck&&this._notifyDropsMove(a,b)},end:function(a){var b=this.get("activeDrop");this._shim&&this._shim.hide();l(this);b&&b._end(a);this.setInternal("activeDrop",null);this.setInternal("activeDrag",null)}},{ATTRS:{dragCursor:{value:"move"},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}}}),v=function(a){a._shim=u('<div style="background-color:red;position:'+(o?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+
a.get("dragCursor")+';z-index:999999;"></div>').prependTo(r.body||r.documentElement).css("opacity",0);v=k;if(o)q.on("resize scroll",s,a);k(a)},s=c.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:w.width(),height:w.height()})},30),n=new n;n.inRegion=a;n.region=g;n.area=b;n.cacheWH=p;n.PREFIX_CLS="ks-dd-";return n});
KISSY.add("dd/draggable",["node","./ddm","base","event/gesture/drag"],function(c,e){function k(a){return function(){this._isValidDrag&&a.apply(this,arguments)}}function j(){o.body.onselectstart=y;o.body.releaseCapture&&o.body.releaseCapture()}function l(){return!1}function g(a){this._isValidDrag=0;this.onGestureStart(a)}var a=e("node"),b=a.Gesture,d=e("./ddm"),p=e("base"),f=e("event/gesture/drag"),n=c.UA,t=a.all,u=t(document),r=c.each,w=n.ie,q=d.PREFIX_CLS,o=c.Env.host.document,v=k(function(a){this._start(a)}),
s=k(function(a){this._move(a)}),h=k(function(a){this._end(a)}),y;return p.extend({initializer:function(){this.addTarget(d);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a)},onGestureStart:function(a){var b=a.target;this._checkDragStartValid(a)&&this._checkHandler(b)&&this._prepare(a)},getEventTargetEl:function(){return this.get("node")},start:function(){var a=this.getEventTargetEl();if(a)a.on(f.DRAG_START,v,this).on(f.DRAG,s,this).on(f.DRAG_END,h,this).on(b.start,
g,this).on("dragstart",this._fixDragStart)},stop:function(){var a=this.getEventTargetEl();a&&a.detach(f.DRAG_START,v,this).detach(f.DRAG,s,this).detach(f.DRAG_END,h,this).detach(b.start,g,this).detach("dragstart",this._fixDragStart)},_onSetDisabled:function(a){var b=this.get("dragNode");if(b)b[a?"addClass":"removeClass"](q+"-disabled");this[a?"stop":"start"]()},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var b=this,d=b.get("handlers"),c=0;r(d,function(d){if(d[0]===a||d.contains(a))return c=
1,b.setInternal("activeHandler",d),!1});return c},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&1!==a.which?0:1},_prepare:function(a){this._isValidDrag=1;w&&(y=o.body.onselectstart,o.body.onselectstart=l,o.body.setCapture&&o.body.setCapture(),u.on(b.end,{fn:j,once:!0}));this.get("halt")&&a.stopPropagation();"mouse"===a.gestureType&&a.preventDefault();this._allowMove&&this.setInternal("startNodePos",this.get("node").offset())},_start:function(a){this.mousePos={left:a.pageX,
top:a.pageY};d.start(a,this);this.fire("dragstart",{drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY});this.get("dragNode").addClass(q+"dragging")},_move:function(a){var b=a.pageX,c=a.pageY;"touch"===a.gestureType&&a.preventDefault();this.mousePos={left:b,top:c};b={drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY};if(c=this._allowMove){var e=this.get("startNodePos"),
f=e.left+a.deltaX,e=e.top+a.deltaY;b.left=f;b.top=e;this.setInternal("actualPos",{left:f,top:e});this.fire("dragalign",b)}f=1;!1===this.fire("drag",b)&&(f=0);d.move(a,this);this.get("preventDefaultOnMove")&&a.preventDefault();f&&c&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){this._isValidDrag&&this._end()},_end:function(a){var a=a||{},b;this._isValidDrag=0;this.get("node").removeClass(q+"drag-over");this.get("dragNode").removeClass(q+"dragging");(b=d.get("activeDrop"))?this.fire("dragdrophit",
{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this});d.end(a,this);this.fire("dragend",{drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY})},_handleOut:function(){this.get("node").removeClass(q+"drag-over");this.fire("dragexit",{drag:this,drop:d.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(q+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},destructor:function(){this.stop()}},
{name:"Draggable",ATTRS:{node:{setter:function(b){if(!(b instanceof a))return t(b)}},dragNode:{},shim:{value:!1},handlers:{value:[],getter:function(a){var b=this;a.length||(a[0]=b.get("node"));r(a,function(d,c){"function"===typeof d&&(d=d.call(b));"string"===typeof d&&(d=b.get("node").one(d));d.nodeType&&(d=t(d));a[c]=d});b.setInternal("handlers",a);return a}},activeHandler:{},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startNodePos:{},
actualPos:{},preventDefaultOnMove:{value:!0}},inheritedStatics:{DropMode:{POINT:"point",INTERSECT:"intersect",STRICT:"strict"}}})});
KISSY.add("dd/draggable-delegate",["node","./ddm","./draggable"],function(c,e){var k=e("node"),j=e("./ddm"),l=e("./draggable"),g=j.PREFIX_CLS,a=k.all;return l.extend({_onSetNode:c.noop,_onSetDisabled:function(a){var d=this.get("container");d&&(d[a?"addClass":"removeClass"](g+"-disabled"),this[a?"stop":"start"]())},getEventTargetEl:function(){return this.get("container")},onGestureStart:function(b){var d,c;if(this._checkDragStartValid(b)){d=this.get("handlers");var e=a(b.target);(d=d.length?this._getHandler(e):
e)&&(c=this._getNode(d));c&&(this.setInternal("activeHandler",d),this.setInternal("node",c),this.setInternal("dragNode",c),this._prepare(b))}},_getHandler:function(a){for(var d=this.get("container"),c=this.get("handlers");a&&a[0]!==d[0];){for(var e=0;e<c.length;e++)if(a.test(c[e]))return a;a=a.parent()}return null},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))}},{ATTRS:{container:{setter:function(b){return a(b)}},selector:{},handlers:{value:[],getter:0}}})});
KISSY.add("dd/droppable",["node","./ddm","base"],function(c,e){var k=e("node"),j=e("./ddm"),l=e("base"),g=j.PREFIX_CLS;return l.extend({initializer:function(){this.addTarget(j);j.addDrop(this)},getNodeFromTarget:function(a,b,d){var a=this.get("node"),c=a[0];return c===b||c===d?null:a},_active:function(){var a=j.get("activeDrag"),b=this.get("node"),d=this.get("groups"),a=a.get("groups");a:if(!0===a)d=1;else{for(var c in d)if(a[c]){d=1;break a}d=0}d?(j.addValidDrop(this),b&&(b.addClass(g+"drop-active-valid"),
j.cacheWH(b))):b&&b.addClass(g+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(g+"drop-active-valid").removeClass(g+"drop-active-invalid")},__getCustomEvt:function(a){return c.mix({drag:j.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(g+"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(g+"drop-over");this.fire("dropenter",
a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(g+"drop-over");this.fire("drophit",a)},destructor:function(){j.removeDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(a){if(a)return k.one(a)}},groups:{value:{}},disabled:{}}})});
KISSY.add("dd/droppable-delegate",["node","./ddm","./droppable"],function(c,e){function k(){var a=this.get("container"),b=[],c=this.get("selector");a.all(c).each(function(a){l.cacheWH(a);b.push(a)});this.__allNodes=b}var j=e("node"),l=e("./ddm"),g=e("./droppable").extend({initializer:function(){l.on("dragstart",k,this)},getNodeFromTarget:function(a,b,d){var e={left:a.pageX,top:a.pageY},a=this.__allNodes,f=0,g=Number.MAX_VALUE;a&&c.each(a,function(a){var c=a[0];c===d||c===b||(c=l.region(a),l.inRegion(c,
e)&&(c=l.area(c),c<g&&(g=c,f=a)))});f&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",f));return f},_handleOut:function(){this.callSuper();this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(a){var b=this.get("node"),c=g.superclass._handleOut,e=this.callSuper,f=g.superclass._handleEnter,j=this.get("lastNode");j[0]!==b[0]?(this.setInternal("node",j),c.apply(this,arguments),this.setInternal("node",b),f.call(this,a)):e.call(this,a)},_end:function(a){this.callSuper(a);
this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return j.one(a)}}}});return g});KISSY.add("dd",["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable-delegate","dd/droppable"],function(c,e){var k=e("dd/ddm"),j=e("dd/draggable"),l=e("dd/draggable-delegate"),g=e("dd/droppable-delegate"),a=e("dd/droppable"),k={Draggable:j,DDM:k,Droppable:a,DroppableDelegate:g,DraggableDelegate:l};return KISSY.DD=k});
