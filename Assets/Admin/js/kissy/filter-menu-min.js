/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 13 18:00
*/
KISSY.add("filter-menu/render-xtpl",["component/extension/content-xtpl"],function(f,g,l,j){f=function(b,a,h){var f,d=a.escapeHtml,a=this.nativeCommands,e=this.utils;"undefined"!==typeof j&&j.kissy&&(f=j);var i=e.callCommand,e=a.include,a='<div id="ks-filter-menu-input-wrap-',c=b.resolve(["id"]),a=a+d(c),a=a+'"\n     class="',c={},k=[];k.push("input-wrap");c.params=k;c=i(this,b,c,"getBaseCssClasses",2);a+=d(c);a+='">\n    <div id="ks-filter-menu-placeholder-';c=b.resolve(["id"]);a+=d(c);a+='"\n         class="';
c={};k=[];k.push("placeholder");c.params=k;c=i(this,b,c,"getBaseCssClasses",4);a+=d(c);a+='">\n        ';c=b.resolve(["placeholder"]);a+=d(c);a+='\n    </div>\n    <input id="ks-filter-menu-input-';c=b.resolve(["id"]);a+=d(c);a+='"\n           class="';c={};k=[];k.push("input");c.params=k;i=i(this,b,c,"getBaseCssClasses",8);a+=d(i);a+='"\n            autocomplete="off"/>\n</div>\n';d={};i=[];i.push("component/extension/content-xtpl");d.params=i;f&&(g("component/extension/content-xtpl"),d.params[0]=
f.resolveByName(d.params[0]));if((b=e.call(this,b,d,h))||0===b)a+=b;return a};f.TPL_NAME=j.name;return f});
KISSY.add("filter-menu/render",["menu","./render-xtpl","component/extension/content-render"],function(f,g){var l=g("menu"),j=g("./render-xtpl"),b=g("component/extension/content-render");return l.getDefaultRender().extend([b],{beforeCreateDom:function(a,b){f.mix(b,{placeholderEl:"#ks-filter-menu-placeholder-{id}",filterInputWrap:"#ks-filter-menu-input-wrap-{id}",filterInput:"#ks-filter-menu-input-{id}"})},getKeyEventTarget:function(){return this.control.get("filterInput")},_onSetPlaceholder:function(a){this.control.get("placeholderEl").html(a)}},
{ATTRS:{contentTpl:{value:j}},HTML_PARSER:{placeholderEl:function(a){return a.one("."+this.getBaseCssClass("placeholder"))},filterInputWrap:function(a){return a.one("."+this.getBaseCssClass("input-wrap"))},filterInput:function(a){return a.one("."+this.getBaseCssClass("input"))}}})});
KISSY.add("filter-menu",["menu","filter-menu/render"],function(f,g){var l=g("menu"),j=g("filter-menu/render");return l.extend({bindUI:function(){this.get("filterInput").on("input",this.handleFilterEvent,this)},handleMouseEnterInternal:function(b){this.callSuper(b);this.view.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var b;b=this.get("filterInput");var a=this.get("highlightedItem");this.set("filterStr",b.val());b=b.val();this.get("allowMultiple")&&(b=b.replace(/^.+,/,""));if(!b&&
a)a.set("highlighted",!1);else if(b&&(!a||!a.get("visible")))(a=this._getNextEnabledHighlighted(0,1))&&a.set("highlighted",!0)},_onSetFilterStr:function(b){this.filterItems(b)},filterItems:function(b){var a=this.get("prefixCls"),h=this.get("placeholderEl"),g=this.get("filterInput");h[b?"hide":"show"]();if(this.get("allowMultiple")){var h=[],d;d=b.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var e=[];d&&(e=d[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(b)?(h=[],d&&(h=e,d=e[e.length-1],(e=(e=this.get("highlightedItem"))&&
e.get("content"))&&-1<e.indexOf(d)&&d&&(h[h.length-1]=e),g.val(h.join(",")+",")),b=""):(d&&(b=d[2]||""),h=e);this.get("enteredItems").length!==h.length&&this.set("enteredItems",h)}var g=this.get("children"),i=b&&RegExp(f.escapeRegExp(b),"ig");f.each(g,function(c){var d=c.get("content");b?-1<d.indexOf(b)?(c.set("visible",!0),c.get("el").html(d.replace(i,function(b){return'<span class="'+a+'menuitem-hit">'+b+"</span>"}))):c.set("visible",!1):(c.get("el").html(d),c.set("visible",!0))})},reset:function(){this.set("filterStr",
"");this.set("enteredItems",[]);this.get("filterInput").val("")}},{ATTRS:{allowTextSelection:{value:!0},placeholder:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},xrender:{value:j}},xclass:"filter-menu"})});
