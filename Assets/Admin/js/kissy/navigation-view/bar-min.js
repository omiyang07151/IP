/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 14 15:40
*/
KISSY.add("navigation-view/bar/bar-xtpl",[],function(m,f,n,g){m=function(g,c,d){var j=this,h=c.escapeHtml,f=j.utils.callCommand,k=j.nativeCommands["if"],c="",l={},b=[],a=g.resolve(["withTitle"]);b.push(a);l.params=b;l.fn=function(b){var a;a='\r\n<div class="';var e={},c=[];c.push("title-wrap");e.params=c;e=f(j,b,e,"getBaseCssClasses",2);a+=h(e);a+='">\r\n    <div class="';e={};c=[];c.push("title");e.params=c;e=f(j,b,e,"getBaseCssClasses",3);a+=h(e);a+='" id="ks-navigation-bar-title-';e=b.resolve(["id"]);
a+=h(e);a+='">';b=b.resolve(["title"]);a+=h(b);return a+"</div>\r\n</div>\r\n"};c+=k.call(j,g,l,d);c+='\r\n<div class="';d={};k=[];k.push("content");d.params=k;d=f(j,g,d,"getBaseCssClasses",6);c+=h(d);c+='" id="ks-navigation-bar-content-';d=g.resolve(["id"]);c+=h(d);c+='">\r\n    <div class="';d={};k=[];k.push("center");d.params=k;d=f(j,g,d,"getBaseCssClasses",7);c+=h(d);c+='" id="ks-navigation-bar-center-';g=g.resolve(["id"]);c+=h(g);return c+'"></div>\r\n</div>'};m.TPL_NAME=g.name;return m});
KISSY.add("navigation-view/bar/bar-render",["./bar-xtpl","component/control"],function(m,f){var n=f("./bar-xtpl");return f("component/control").getDefaultRender().extend({createDom:function(){var g={centerEl:"#ks-navigation-bar-center-{id}",contentEl:"#ks-navigation-bar-content-{id}"};this.control._withTitle&&(g.titleEl="#ks-navigation-bar-title-{id}");this.fillChildrenElsBySelectors(g)},_onSetTitle:function(g){this.control._withTitle&&this.control.get("titleEl").html(g)},_onSetBackText:function(g){this.control._backBtn&&
this.control._backBtn.set("content",g)}},{ATTRS:{contentTpl:{value:n}}})});
KISSY.add("navigation-view/bar",["component/control","./bar/bar-render","button"],function(m,f){function n(b){var a;a=b.clone(!0);a[0].id=b[0].id+"-proxy";b.parent().append(a);var c=b.offset();a.css("position","absolute");a.offset(c);a.css({width:b.css("width"),height:b.css("height")});return a}function g(b,a,c){b.animate(a,{duration:0.25,easing:"ease-in-out",complete:c})}function o(b,a,c,g){var e=b.get("el"),d=b.get("titleEl"),b=Math.min(e[0].offsetWidth/3,200),f=a[0].offsetWidth,a=e[0].offsetWidth,
e=d.offset().left-e.offset().left,d=d[0].offsetWidth,i=c.width,h;g?(c=-i,i=Math.min(e-i,b)):(i=-i,c=Math.min(e,b));b={element:{from:{transform:"translateX("+c+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+i+"px) translateZ(0)",opacity:0}}};f=-e+f;d>e&&(h=-e-d);g?(i=a-e-d,c=void 0!==h?h:f):(i=void 0!==h?h:f,c=Math.max(0,a-e-d));return{back:b,title:{element:{from:{transform:"translateX("+c+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",
opacity:1}},ghost:{to:{transform:"translateX("+i+"px) translateZ(0)",opacity:0}}}}}function c(){this.fire("backward")}function d(){this.get("navigationView").pop()}function j(b){this.set("title",b.newView.get("title")||"")}function h(b){var a=b.newView,c=b.backward;if(b.oldView)this[c?"backward":"forward"](a.get("title")||"")}var p=f("component/control"),k=f("./bar/bar-render"),l=f("button");return p.extend({initializer:function(){this._withTitle=this.get("withTitle");this._stack=[];this.publish("backward",
{defaultFn:d,defaultTargetOnly:!0})},renderUI:function(){var b=this.get("prefixCls");this._buttons={};this.get("withBackButton")&&(this._backBtn=(new l({prefixCls:b+"navigation-bar-",elCls:b+"navigation-bar-backward",elBefore:this.get("contentEl")[0].firstChild,visible:!1,content:this.get("backText")})).render())},bindUI:function(){if(this._backBtn)this._backBtn.on("click",c,this);var b=this.get("navigationView");b.on("afterInnerViewChange",j,this);b.on("beforeInnerViewChange",h,this)},addButton:function(b,
a){var c=this.get("prefixCls");a.prefixCls=c+"navigation-bar-";!a.elBefore&&!a.render&&(c=a.align=a.align||"left","left"===c?a.elBefore=this.get("centerEl"):"right"===c&&(a.render=this.get("contentEl")),delete a.align);this._buttons[b]=(new l(a)).render();return this._buttons[b]},insertButtonBefore:function(b,a,c){a.elBefore=c.get("el");return this.addButton(b,a)},removeButton:function(b){this._buttons[b].destroy();delete this._buttons[b]},getButton:function(b){return this._buttons[b]},forward:function(b){this._stack.push(b);
this.go(b,!0)},go:function(b,a,c){var d=this,e=d._backBtn;if(!e||!d._withTitle){if(d._withTitle&&d.get("titleEl").html(b),e)e[a?"show":"hide"]()}else{var f=e.get("el");f.stop(!0);d.ghostBackEl&&d.ghostBackEl.stop(!0);var h={width:f[0].offsetWidth},i=n(f);d.ghostBackEl=i;f.css("opacity",0);e[a?"show":"hide"]();d.ghostBackEl&&d.ghostBackEl.stop(!0);a=o(d,f,h,c);f.css(a.back.element.from);e.get("visible")&&g(f,a.back.element.to);"none"!==i.css("display")?g(i,a.back.ghost.to,function(){i.remove();d.ghostBackEl=
null}):(i.remove(),d.ghostBackEl=null);e=d.get("titleEl");e.stop(!0);var j=n(e.parent());d.ghostTitleEl=j;e.css("opacity",0);d.set("title",b);e.css(a.title.element.from);g(e,a.title.element.to);g(j,a.title.ghost.to,function(){j.remove();d.ghostTitleEl=null})}},backward:function(b){this._stack.length&&(this._stack.pop(),this.go(b,this._stack.length,!0))}},{xclass:"navigation-bar",ATTRS:{handleGestureEvents:{value:!1},focusable:{value:!1},xrender:{value:k},centerEl:{},contentEl:{},titleEl:{},title:{value:"",
view:1},withBackButton:{value:1},withTitle:{value:1,view:1},backText:{value:"Back",view:1}}})});
