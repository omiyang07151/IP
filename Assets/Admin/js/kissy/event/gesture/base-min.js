/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 14 15:42
*/
KISSY.add("event/gesture/base/add-event",["dom","event/dom/base"],function(b,d){function g(a){return b.startsWith(a,"touch")}function m(a){return b.startsWith(a,"mouse")}function h(a){return b.startsWith(a,"MSPointer")||b.startsWith(a,"pointer")}function j(a){this.doc=a;this.eventHandles=[];this.init();this.touches=[];this.inTouch=0}function r(a){x(this,a)}function u(a){n(this,a)}function v(a){x(this,a);k[a].setup.apply(this,arguments)}function l(a){n(this,a);k[a].tearDown.apply(this,arguments)}function x(a,
c){var e=o.getDocument(a),f=o.data(e,p);f||o.data(e,p,f=new j(e));c&&f.addEventHandle(c)}function n(a,c){var e=o.getDocument(a),f=o.data(e,p);f&&(c&&f.removeEventHandle(c),f.eventHandles.length||(f.destroy(),o.removeData(e,p)))}var o=d("dom"),k={},i=d("event/dom/base"),y=i.Special,p=b.guid("touch-handle"),w=b.Feature,s,q,t;w.isTouchEventSupported()?b.UA.ios?(t="touchend touchcancel",s="touchstart",q="touchmove"):(t="touchend touchcancel mouseup",s="touchstart mousedown",q="touchmove mousemove"):w.isPointerSupported()?
(s="pointerdown",q="pointermove",t="pointerup pointercancel"):w.isMsPointerSupported()?(s="MSPointerDown",q="MSPointerMove",t="MSPointerUp MSPointerCancel"):(s="mousedown",q="mousemove",t="mouseup");j.prototype={constructor:j,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;i.on(a,s,this.onTouchStart,this);if(!h(q))i.on(a,q,this.onTouchMove,this);i.on(a,t,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(a){for(var c=0,e=a.pointerId,
f=this.touches,b=f.length;c<b;c++){a=f[c];if(a.pointerId===e){f.splice(c,1);break}}},updateTouch:function(a){for(var c=0,e,f=a.pointerId,b=this.touches,g=b.length;c<g;c++){e=b[c];e.pointerId===f&&(b[c]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var c=this.lastTouches,a=a.changedTouches[0];
if(this.isPrimaryTouch(a)){var e={x:a.clientX,y:a.clientY};c.push(e);setTimeout(function(){var a=c.indexOf(e);a>-1&&c.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var c=this.lastTouches,e=a.clientX,a=a.clientY,f=0,b=c.length,g;f<b&&(g=c[f]);f++){var l=Math.abs(e-g.x),h=Math.abs(a-g.y);if(l<=25&&h<=25)return true}return 0},normalize:function(a){var c=a.type,e,f;if(e=g(c)){f=c==="touchend"||c==="touchcancel"?a.changedTouches:a.touches;a.gestureType="touch"}else{if(h(c))a.gestureType=
a.originalEvent.pointerType;else if(m(c))a.gestureType="mouse";f=this.touches}if(f&&f.length===1){a.which=1;a.pageX=f[0].pageX;a.pageY=f[0].pageY}if(e)return a;c=!c.match(/(up|cancel)$/i);a.touches=c?f:[];a.targetTouches=c?f:[];a.changedTouches=f;return a},onTouchStart:function(a){var c,e=a.type,f=this.eventHandles;if(g(e)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(m(e)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a]}else if(h(e)){this.addTouch(a.originalEvent);
if(this.touches.length===1)i.on(this.doc,q,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(var e=0,b=f.length;e<b;e++){c=f[e];c=f[c].handle;c.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var c=a.type;if(m(c)){if(this.isEventSimulatedFromTouch(c))return;this.touches=[a]}else if(h(c))this.updateTouch(a.originalEvent);else if(!g(c))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var c=
this,e=a.type;if(!m(e)||!c.isEventSimulatedFromTouch(a)){c.callEventHandle("onTouchEnd",a);if(g(e)){c.dupMouse(a);b.makeArray(a.changedTouches).forEach(function(a){c.removePrimaryTouch(a)})}else if(m(e))c.touches=[];else if(h(e)){c.removeTouch(a.originalEvent);c.touches.length||i.detach(c.doc,q,c.onTouchMove,c)}}},callEventHandle:function(a,c){var e=this.eventHandles,f=e.concat(),b,c=this.normalize(c),g=c.gestureType;if(c.changedTouches.length){for(var l=0,h=f.length;l<h;l++){b=f[l];if(e[b]){b=e[b].handle;
if(!(b.requiredGestureType&&g!==b.requiredGestureType)&&!b.processed){b.processed=1;if(b.isActive&&b[a]&&b[a](c)===false)b.isActive=0}}}l=0;for(h=f.length;l<h;l++){b=e[l];if(e[b]){b=e[b].handle;b.processed=0}}}},addEventHandle:function(a){var c=this.eventHandles,b=k[a].handle;if(c[a])c[a].count++;else{c.push(a);this.sortEventHandles();c[a]={count:1,handle:b}}},sortEventHandles:function(){this.eventHandles.sort(function(a,c){return k[a].order-k[c].order})},removeEventHandle:function(a){var c=this.eventHandles;
if(c[a]){c[a].count--;if(!c[a].count){c.splice(b.indexOf(a,c),1);delete c[a]}}},destroy:function(){var a=this.doc;i.detach(a,s,this.onTouchStart,this);i.detach(a,q,this.onTouchMove,this);i.detach(a,t,this.onTouchEnd,this)}};return function(a,c){typeof a==="string"&&(a=[a]);b.each(a,function(a){var b={};b.setup=c.setup?v:r;b.tearDown=c.tearDown?l:u;b.add=c.add;b.remove=c.remove;c.order=c.order||100;k[a]=c;y[a]=b})}});
KISSY.add("event/gesture/base/touch",[],function(b){function d(){}b=b.noop;d.prototype={constructor:d,requiredTouchCount:0,onTouchStart:function(b){var d=this.requiredTouchCount,h=b.touches.length;if(h===d)return this.isTracking||(this.isTracking=!0,this.isStarted=!1),this.lastTouches=b.touches,this.startTime=b.timeStamp,this.start(b);if(h>d)this.onTouchEnd(b,!0)},onTouchMove:function(b){if(this.isTracking)return this.lastTouches=b.touches,this.move(b)},onTouchEnd:function(b,d){this.isTracking&&(this.isTracking=
!1,this.isStarted&&(this.isStarted=!1,this.end(b,d)))},start:b,move:b,end:b};return d});KISSY.add("event/gesture/base/single-touch",["./touch"],function(b,d){function g(){}var m=d("./touch");b.extend(g,m,{requiredTouchCount:1,start:function(){g.superclass.start.apply(this,arguments);var b=this.lastTouches;this.lastXY={pageX:b[0].pageX,pageY:b[0].pageY}}});return g});
KISSY.add("event/gesture/base/tap",["./add-event","event/dom/base","./single-touch"],function(b,d){function g(b){b.preventDefault()}function m(b){b.singleTapTimer&&(clearTimeout(b.singleTapTimer),b.singleTapTimer=0);b.tapHoldTimer&&(clearTimeout(b.tapHoldTimer),b.tapHoldTimer=0)}function h(){h.superclass.constructor.apply(this,arguments)}var j=d("./add-event"),r=d("event/dom/base"),u=d("./single-touch"),v=r.Object;b.extend(h,u,{start:function(l){var d=this;h.superclass.start.call(d,l);m(d);var g=
d.lastTouches[0];d.tapHoldTimer=setTimeout(function(){var h=b.mix({touch:g,which:1,TAP_HOLD_DELAY:(b.now()-l.timeStamp)/1E3},d.lastXY);d.tapHoldTimer=0;d.lastXY=0;r.fire(g.target,"tapHold",h)},1E3);d.isStarted=!0},move:function(){var b;if(!(b=this.lastXY))return!1;var d=this.lastTouches[0];if(!d||5<Math.abs(d.pageX-b.pageX)||5<Math.abs(d.pageY-b.pageY))return m(this),!1},end:function(d,h){var n;m(this);if(!h&&(n=this.lastXY)){var o=this.lastTouches[0],k=o.target,i=new v(d.originalEvent);b.mix(i,{type:"tap",
which:1,pageX:n.pageX,pageY:n.pageY,target:k,currentTarget:k});i.touch=o;r.fire(k,"tap",i);if(i.isDefaultPrevented()&&b.UA.mobile)if(b.UA.ios)d.preventDefault();else r.on(k.ownerDocument||k,"click",{fn:g,once:1});var i=this.lastEndTime,j=d.timeStamp,p;this.lastEndTime=j;if(i&&(p=j-i,300>p)){this.lastEndTime=0;r.fire(k,"doubleTap",{touch:o,pageX:n.pageX,pageY:n.pageY,which:1,duration:p/1E3});return}p=j-this.startTime;300<p?r.fire(k,"singleTap",{touch:o,pageX:n.pageX,pageY:n.pageY,which:1,duration:p/
1E3}):this.singleTapTimer=setTimeout(function(){r.fire(k,"singleTap",{touch:o,pageX:n.pageX,pageY:n.pageY,which:1,duration:p/1E3})},300)}}});j(["tap","doubleTap","singleTap","tapHold"],{handle:new h});return{tap:"tap",TAP:"tap",singleTap:"singleTap",SINGLE_TAP:"singleTap",DOUBLE_TAP:"doubleTap",doubleTap:"doubleTap",TAP_HOLD:"tapHold"}});
KISSY.add("event/gesture/base",["event/dom/base","./base/add-event","./base/tap","./base/touch","./base/single-touch"],function(b,d){function g(b,d){var g={isActive:1};g[d]=function(d){m.fire(d.target,b,d)};h(b,{order:1,handle:g})}var m=d("event/dom/base"),h=d("./base/add-event"),j={start:"gestureStart",START:"gestureStart",move:"gestureMove",MOVE:"gestureMove",end:"gestureEnd",END:"gestureEnd"};g(j.START,"onTouchStart");g(j.MOVE,"onTouchMove");g(j.END,"onTouchEnd");b.mix(j,d("./base/tap"));return{Enumeration:j,
addEvent:h,Touch:d("./base/touch"),SingleTouch:d("./base/single-touch")}});
