/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 17 21:36
*/
KISSY.add("xtemplate/runtime/scope",[],function(k){function j(a,e){this.data=a||{};this.affix=e;this.root=this}j.prototype={isScope:1,setParent:function(a){this.parent=a;this.root=a.root},getParent:function(){return this.parent},getRoot:function(){return this.root},set:function(a,e){this.affix||(this.affix={});this.affix[a]=e},setData:function(a){this.data=a},getData:function(){return this.data},mix:function(a){this.affix||(this.affix={});k.mix(this.affix,a)},has:function(a){var e=this.data,h=this.affix;
return"this"===a||h&&a in h?!0:"object"===typeof e&&a in e},get:function(a){var e=this.data,h=this.affix;if("this"===a)return this.data;if(h&&a in h)return h[a];if("object"===typeof e&&a in e)return e[a]},resolve:function(a,e){var h=this;if(!e&&"string"!==typeof a&&1===a.length&&h.has(a[0]))return h.get(a[0]);var b=a;"string"===typeof a&&(b=a.split("."));var c,d,f,i,g;if("root"===b[0])b.shift(),h=h.root;else if(e)for(;h&&e--;)h=h.parent;var m=0;for(c=b.length;h;){g=1;f=h;for(d=0;d<c;d++)if(i=b[d],
"this"===i)m=1;else if(f===h)if(h.has(i))f=h.get(i),m=1;else{g=0;break}else{if(null==f||"object"!==typeof f||!(i in f)){g=0;break}f=f[i]}if(g)return f&&f.isScope&&(f=f.data),"function"===typeof f&&(f=f.call(this.data)),f;if(m)break;h=h.parent}}};return j});
KISSY.add("xtemplate/runtime/commands",["./scope"],function(k,j){var a,e=j("./scope");return a={"debugger":k.noop,each:function(h,b){var c=b.params,d=c[0],f=c[2]||"xindex",c=c[1],i="",g,a,l;if(d)if(a=new e,k.isArray(d)){g=d.length;l=a.affix={xcount:g};for(var j=0;j<g;j++)a.data=d[j],l[f]=j,c&&(l[c]=d[j]),a.setParent(h),i+=b.fn(a)}else for(g in l=a.affix={},d)a.data=d[g],l[f]=g,c&&(l[c]=d[g]),a.setParent(h),i+=b.fn(a);else b.inverse&&(i=b.inverse(h));return i},"with":function(h,b){var a=b.params[0],
d="";a?(a=new e(a),a.setParent(h),d=b.fn(a)):b.inverse&&(d=b.inverse(h));return d},"if":function(a,b){var c="";b.params[0]?b.fn&&(c=b.fn(a)):b.inverse&&(c=b.inverse(a));return c},set:function(a,b){a.mix(b.hash);return""},include:function(a,b,c){var d=b.params;b.hash&&(b=new e(b.hash),b.setParent(a),a=b);b=this.name;d=d[0];if("."===d.charAt(0)){if(!b)return"";var f=d,d=b.split("/"),b=f.split("/");d.pop();for(var f=0,i=b.length;f<i;f++){var g=b[f];"."!==g&&(".."===g?d.pop():d.push(g))}d=d.join("/")}return this.load(d).render(a,
c)},parse:function(h,b){return a.include.call(this,new e,b)},extend:function(a,b,c){c.extendTplName=b.params[0]},block:function(a,b,c){var d=b.params,f=d[0],i;2===d.length&&(i=d[0],f=d[1]);var d=c.blocks=c.blocks||{},g=d[f];i={fn:b.fn,type:i};if(g){if(g.type)if("append"===g.type)i.next=g,d[f]=i;else if("prepend"===g.type){for(var e,b=g;b&&"prepend"===b.type;)e=b,b=b.next;i.next=b;e.next=i}}else d[f]=i;e="";if(!c.extendTplName)for(b=d[f];b;)b.fn&&(e+=b.fn.call(this,a)),b=b.next;return e},macro:function(a,
b,c){var a=b.params,d=a[0],a=a.slice(1),c=c.macros=c.macros||{};if(b.fn)c[d]={paramNames:a,fn:b.fn};else{var b={},d=c[d],f;if(d&&(f=d.paramNames)){for(var c=0,i=f.length;c<i;c++)b[f[c]]=a[c];f=new e(b);return d.fn.call(this,f)}}return""}}});
KISSY.add("xtemplate/runtime",["./runtime/commands","./runtime/scope"],function(k,j){function a(a,b){this.tpl=a;b=b||{};b.name&&(this.name=b.name);this.config=b}var e=j("./runtime/commands"),h={},b=j("./runtime/scope"),c={normalizeOutput:function(a){return!a&&0!==a?"":a},callCommand:function(a,b,i,g){var c="";var e=a.config.commands;if(-1===g.indexOf("."))g=e&&e[g]||h[g];else{g=g.split(".");if(e=e&&e[g[0]]||h[g[0]])for(var j=g.length,k=1;k<j&&!(e=e[g[k]],!e);k++);g=e}if(g)try{c=g.call(a,b,i)}catch(n){}return c}};
k.mix(a,{nativeCommands:e,utils:c,addCommand:function(a,b){h[a]=b},removeCommand:function(a){delete h[a]}});a.prototype={constructor:a,nativeCommands:e,utils:c,load:function(a){var b=new this.constructor(k.require(a),this.config);b.name=a;return b},removeCommand:function(a){var b=this.config;b.commands&&delete b.commands[a]},addCommand:function(a,b){var e=this.config;e.commands=e.commands||{};e.commands[a]=b},render:function(a,f){var c=a;if(!c||!c.isScope)c=new b(a);f=f||{};f.extendTplName=null;this.tpl.TPL_NAME&&
!this.name&&(this.name=this.tpl.TPL_NAME);var g=this.tpl(c,k,f),h=f.extendTplName;return h?e.include.call(this,c,{params:[h]},f):g}};a.Scope=b;return a});
