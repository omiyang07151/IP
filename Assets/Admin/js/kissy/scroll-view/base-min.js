/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 14 15:40
*/
KISSY.add("scroll-view/base/render",["component/container","component/extension/content-render"],function(l,e){var p=e("component/container"),q=e("component/extension/content-render"),n=l.Feature.getCssVendorInfo("transform"),i=Math.floor,m,o=l.Feature.isTransform3dSupported(),j={syncUI:function(){var d=this.control,a=d.el,b=d.contentEl,c=Math.max(b.offsetHeight,b.scrollHeight),b=Math.max(b.offsetWidth,b.scrollWidth);d.set("dimension",{scrollHeight:c,scrollWidth:b,clientWidth:a.clientWidth,clientHeight:a.clientHeight})},
_onSetScrollLeft:function(d){this.control.contentEl.style.left=-d+"px"},_onSetScrollTop:function(d){this.control.contentEl.style.top=-d+"px"}};n&&(m=n.propertyName,j._onSetScrollLeft=function(d){var a=this.control;a.contentEl.style[m]="translateX("+i(-d)+"px) translateY("+i(-a.get("scrollTop"))+"px)"+(o?" translateZ(0)":"")},j._onSetScrollTop=function(d){var a=this.control;a.contentEl.style[m]="translateX("+i(-a.get("scrollLeft"))+"px) translateY("+i(-d)+"px)"+(o?" translateZ(0)":"")});return p.getDefaultRender().extend([q],
j,{name:"ScrollViewRender"})});
KISSY.add("scroll-view/base",["node","anim/timer","component/container","./base/render"],function(l,e){function p(){var a=this.el,b=a.scrollTop,c=a.scrollLeft;b&&this.set("scrollTop",b+this.get("scrollTop"));c&&this.set("scrollLeft",c+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0}function q(a,b){a.scrollView.set(b.prop,b.val)}var n=e("node"),i=e("anim/timer"),m=e("component/container"),o=e("./base/render"),j=l.all,d=n.KeyCode;return m.extend({initializer:function(){this.scrollAnims=[]},bindUI:function(){this.$el.on("mousewheel",
this.handleMouseWheel,this).on("scroll",p,this)},sync:function(){var a=this.el,b=this.contentEl,c=Math.max(b.offsetHeight,b.scrollHeight),b=Math.max(b.offsetWidth,b.scrollWidth);this.set("dimension",{scrollHeight:c,scrollWidth:b,clientWidth:a.clientWidth,clientHeight:a.clientHeight})},_onSetDimension:function(a,b){var c=this.$contentEl,g=a.scrollHeight,k=a.scrollWidth,f=a.clientHeight,d,h=a.clientWidth;d=b&&b.prevVal||{};if(!(d.scrollHeight===g&&d.scrollWidth===k&&f===d.clientHeight&&h===d.clientWidth)){this.scrollHeight=
g;this.scrollWidth=k;this.clientHeight=f;this.clientWidth=h;d=this.allowScroll={};g>f&&(d.top=1);k>h&&(d.left=1);this.minScroll={left:0,top:0};var e,i;this.maxScroll={left:e=k-h,top:i=g-f};delete this.scrollStep;f=this.get("snap");g=this.get("scrollLeft");k=this.get("scrollTop");if(f){var j=c.offset(),c=this.pages="string"===typeof f?c.all(f):c.children(),f=this.get("pageIndex"),l=this.pagesOffset=[];c.each(function(a,b){var c=a.offset(),g=c.left-j.left,c=c.top-j.top;g<=e&&c<=i&&(l[b]={left:g,top:c,
index:b})});if(f){this.scrollToPage(f);return}}this.scrollToWithBounds({left:g,top:k});this.fire("reflow",a)}},handleKeyDownInternal:function(a){var b=j(a.target),c=b.nodeName();if(!("input"===c||"textarea"===c||"select"===c||b.hasAttr("contenteditable"))){var a=a.keyCode,b=this.getScrollStep(),g,c=this.allowScroll.left;if(this.allowScroll.top){var k=b.top,f=this.clientHeight,e=this.get("scrollTop");a===d.DOWN?(this.scrollToWithBounds({top:e+k}),g=!0):a===d.UP?(this.scrollToWithBounds({top:e-k}),
g=!0):a===d.PAGE_DOWN?(this.scrollToWithBounds({top:e+f}),g=!0):a===d.PAGE_UP&&(this.scrollToWithBounds({top:e-f}),g=!0)}c&&(b=b.left,c=this.get("scrollLeft"),a===d.RIGHT?(this.scrollToWithBounds({left:c+b}),g=!0):a===d.LEFT&&(this.scrollToWithBounds({left:c-b}),g=!0));return g}},getScrollStep:function(){if(this.scrollStep)return this.scrollStep;var a=j(this.get("el")[0].ownerDocument),b=this.clientHeight,c=this.clientWidth;return this.scrollStep={top:Math.max(0.7*b*b/a.height(),20),left:Math.max(0.7*
c*c/a.width(),20)}},handleMouseWheel:function(a){if(!this.get("disabled")){var b,c,g=this.getScrollStep(),d,f=this.maxScroll,e=this.minScroll;if((d=a.deltaY)&&this.allowScroll.top){var h=this.get("scrollTop");b=f.top;c=e.top;h<=c&&0<d||h>=b&&0>d||(this.scrollToWithBounds({top:h-a.deltaY*g.top}),a.preventDefault())}if((d=a.deltaX)&&this.allowScroll.left)h=this.get("scrollLeft"),b=f.left,c=e.left,h<=c&&0<d||h>=b&&0>d||(this.scrollToWithBounds({left:h-a.deltaX*g.left}),a.preventDefault())}},stopAnimation:function(){this.scrollAnims.length&&
(l.each(this.scrollAnims,function(a){a.stop()}),this.scrollAnims=[]);this.scrollToWithBounds({left:this.get("scrollLeft"),top:this.get("scrollTop")})},_uiSetPageIndex:function(a){this.scrollToPage(a)},getPageIndexFromXY:function(a,b,c){var d=this.pagesOffset.concat([]),e=b?"left":"top";d.sort(function(a,b){return a[e]-b[e]});if(0<c)for(b=0;b<d.length;b++){if(c=d[b],c[e]>=a)return c.index}else for(b=d.length-1;0<=b;b--)if(c=d[b],c[e]<=a)return c.index},scrollToPage:function(a,b){var c;if((c=this.pagesOffset)&&
c[a])this.set("pageIndex",a),this.scrollTo(c[a],b)},scrollToWithBounds:function(a,b){var c=this.maxScroll,d=this.minScroll;a.left&&(a.left=Math.min(Math.max(a.left,d.left),c.left));a.top&&(a.top=Math.min(Math.max(a.top,d.top),c.top));this.scrollTo(a,b)},scrollTo:function(a,b){var c=a.left,d=a.top;if(b){var e={},f={};void 0!==c&&(f.scrollLeft=c,e.scrollLeft=this.get("scrollLeft"));void 0!==d&&(f.scrollTop=d,e.scrollTop=this.get("scrollTop"));b.frame=q;b.node=e;b.to=f;this.scrollAnims.push(c=new i(b));
c.scrollView=this;c.run()}else void 0!==c&&this.set("scrollLeft",c),void 0!==d&&this.set("scrollTop",d)}},{ATTRS:{contentEl:{},scrollLeft:{view:1,value:0},scrollTop:{view:1,value:0},dimension:{},focusable:{value:!0},allowTextSelection:{value:!0},handleGestureEvents:{value:!1},snap:{value:!1},pageIndex:{value:0},xrender:{value:o}},xclass:"scroll-view"})});
